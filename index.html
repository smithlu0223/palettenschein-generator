<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Palettenschein Generator</title>
  <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #111;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    .hidden { display: none; }
    input, select, button, canvas {
      padding: 8px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 300px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    canvas { background: white; border: 1px solid #888; }
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    .container { max-width: 400px; width: 100%; }
    label { display: block; margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <div id="login-box">
      <h2>üîê Passwort</h2>
      <input type="password" id="password-input" placeholder="Gib das Passwort ein" />
      <button onclick="checkPassword()">Login</button>
      <p id="login-error" style="color: red; display: none;">‚ùå Falsches Passwort!</p>
    </div>

    <form id="main-form" class="hidden">
      <h2>Palettenschein Generator</h2>
      <label>Datum</label>
      <input type="date" id="datum" required>

      <label>Nr</label>
      <input type="text" id="nr" required>

      <label>Spedition</label>
      <select id="spedition">
        <option>DHL</option>
        <option>GLS</option>
        <option>Intern</option>
      </select>

      <label>Kunde / Empf√§nger</label>
      <input type="text" id="empfaenger">

      <label>Lieferant</label>
      <input type="text" id="lieferant">

      <label>Lieferschein-Nr.</label>
      <input type="text" id="lieferschein" required>

      <label>Europaletten</label>
      <input type="number" id="euro" required>

      <label>Einwegpaletten</label>
      <input type="number" id="einweg" required>

      <label>Sonstiger Hinweis</label>
      <input type="text" id="sonstiges">

      <label>Unterschrift</label>
      <canvas id="sign" width="300" height="100"></canvas>
      <button type="button" onclick="clearCanvas()">Signatur l√∂schen</button>

      <button type="submit">PDF + Excel Erstellen</button>
    </form>
  </div>

  <script>
    const PASSWORD = "Dlog2025";

    function checkPassword() {
      const pw = document.getElementById("password-input").value;
      if (pw === PASSWORD) {
        document.getElementById("login-box").style.display = "none";
        document.getElementById("main-form").classList.remove("hidden");
      } else {
        document.getElementById("login-error").style.display = "block";
      }
    }

    // Signature drawing
    const canvas = document.getElementById("sign");
    const ctx = canvas.getContext("2d");
    let drawing = false;

    canvas.addEventListener("mousedown", e => {
      drawing = true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });
    canvas.addEventListener("mousemove", e => {
      if (!drawing) return;
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
    });
    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mouseout", () => drawing = false);

    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Submit event
    document.getElementById("main-form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        Datum: document.getElementById("datum").value,
        Nr: document.getElementById("nr").value,
        Spedition: document.getElementById("spedition").value,
        "Kunde/Empf√§nger": document.getElementById("empfaenger").value,
        Lieferant: document.getElementById("lieferant").value,
        "Lieferschein-Nr.": document.getElementById("lieferschein").value,
        Europaletten: document.getElementById("euro").value,
        Einwegpaletten: document.getElementById("einweg").value,
        "Sonstiger Hinweis": document.getElementById("sonstiges").value
      };

      const signature = canvas.toDataURL("image/png");

      // PDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      let y = 20;
      doc.text("Palettenschein", 105, y, { align: "center" });
      y += 10;
      for (const [k, v] of Object.entries(data)) {
        doc.text(`${k}: ${v}`, 20, y);
        y += 8;
      }
      doc.addImage(signature, "PNG", 20, y, 80, 30);
      doc.text("Unterschrift", 20, y + 35);
      doc.save(`Palettenschein_${data.Nr}.pdf`);

      // Excel
      const ws = XLSX.utils.json_to_sheet([data]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Palettenschein");
      XLSX.writeFile(wb, `Palettenschein_${data.Nr}.xlsx`);

      alert("PDF und Excel erfolgreich erstellt.");
      document.getElementById("main-form").reset();
      clearCanvas();
    });
  </script>
</body>
</html>
